{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/viveks/PycharmProjects/resume-builder/src/app/api/resumes/improve-text/route.ts"],"sourcesContent":["import { auth } from \"@clerk/nextjs/server\"\nimport { NextResponse } from \"next/server\"\nimport OpenAI from \"openai\"\n\nexport async function POST(request: Request) {\n  try {\n    const authResult = await auth()\n    const userId = authResult?.userId\n    \n    if (!userId) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    }\n\n    if (!process.env.OPENAI_API_KEY) {\n      return NextResponse.json(\n        { error: \"OpenAI API key is not configured\" },\n        { status: 500 }\n      )\n    }\n\n    const { text, sectionType, sectionId } = await request.json()\n\n    if (!text || typeof text !== \"string\" || text.trim().length === 0) {\n      return NextResponse.json(\n        { error: \"Text is required\" },\n        { status: 400 }\n      )\n    }\n\n    const openai = new OpenAI({\n      apiKey: process.env.OPENAI_API_KEY,\n    })\n\n    // Create context-aware prompt based on section type\n    let contextPrompt = \"\"\n    switch (sectionType) {\n      case \"heading\":\n        contextPrompt = \"This is a resume section heading. Provide 3-5 alternative headings that are professional, clear, and ATS-friendly.\"\n        break\n      case \"statement\":\n        contextPrompt = \"This is a professional statement or bullet point from a resume. Provide 3-5 alternative versions that are more impactful, use action verbs, and are optimized for ATS systems. Keep the same meaning but make it more compelling.\"\n        break\n      case \"description\":\n        contextPrompt = \"This is a work experience or project description from a resume. Provide 3-5 alternative versions that are more concise, use strong action verbs, include quantifiable achievements when possible, and are ATS-optimized. Format as bullet points if the original is a paragraph.\"\n        break\n      case \"summary\":\n        contextPrompt = \"This is a professional summary from a resume. Provide 3-5 alternative versions that are more compelling, highlight key achievements, and are optimized for ATS systems. Keep it concise (2-4 sentences or bullet points).\"\n        break\n      case \"skill\":\n        contextPrompt = \"This is a skills section from a resume. Provide 3-5 alternative ways to present these skills that are more organized, ATS-friendly, and highlight relevant competencies.\"\n        break\n      default:\n        contextPrompt = \"This is text from a resume. Provide 3-5 alternative versions that are more professional, impactful, and ATS-optimized.\"\n    }\n\n    const prompt = `${contextPrompt}\n\nOriginal text:\n${text}\n\nReturn a JSON object with an \"alternatives\" property containing an array of 3-5 alternative versions, each as a string. Do not include any explanations or markdown formatting. Example format: {\"alternatives\": [\"alternative 1\", \"alternative 2\", \"alternative 3\"]}`\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      messages: [\n        {\n          role: \"user\",\n          content: prompt,\n        },\n      ],\n      response_format: { type: \"json_object\" },\n      max_tokens: 2000,\n      temperature: 0.7,\n    })\n\n    const content = response.choices[0]?.message?.content || \"{}\"\n    let parsedContent\n    \n    try {\n      parsedContent = JSON.parse(content)\n    } catch (parseError) {\n      console.error(\"Failed to parse JSON:\", parseError)\n      // Try to extract JSON object from text\n      const jsonMatch = content.match(/\\{[\\s\\S]*\\}/)\n      if (jsonMatch) {\n        try {\n          parsedContent = JSON.parse(jsonMatch[0])\n        } catch (e) {\n          console.error(\"Failed to parse extracted JSON:\", e)\n        }\n      }\n      \n      // If still no valid JSON, try to extract array\n      if (!parsedContent || typeof parsedContent !== \"object\") {\n        const arrayMatch = content.match(/\\[[\\s\\S]*\\]/)\n        if (arrayMatch) {\n          try {\n            const array = JSON.parse(arrayMatch[0])\n            parsedContent = { alternatives: Array.isArray(array) ? array : [content.trim()] }\n          } catch (e) {\n            parsedContent = { alternatives: [content.trim()] }\n          }\n        } else {\n          // Fallback: treat response as single alternative\n          parsedContent = { alternatives: [content.trim()] }\n        }\n      }\n    }\n\n    // Extract alternatives array\n    let alternatives: string[] = []\n    if (parsedContent && typeof parsedContent === \"object\") {\n      if (Array.isArray(parsedContent.alternatives)) {\n        alternatives = parsedContent.alternatives\n      } else if (Array.isArray(parsedContent)) {\n        alternatives = parsedContent\n      } else {\n        // Try to find any array property\n        const arrayValues = Object.values(parsedContent).filter(Array.isArray)\n        if (arrayValues.length > 0) {\n          alternatives = arrayValues[0] as string[]\n        }\n      }\n    }\n\n    // Ensure we have at least one alternative\n    if (alternatives.length === 0) {\n      // Try to split by newlines or bullets as fallback\n      const lines = content.split(/\\n/).filter(line => line.trim().length > 0)\n      if (lines.length > 0) {\n        alternatives = lines.slice(0, 5)\n      } else {\n        alternatives = [text] // Fallback to original\n      }\n    }\n\n    // Limit to 5 alternatives\n    alternatives = alternatives.slice(0, 5)\n\n    return NextResponse.json({ alternatives })\n  } catch (error) {\n    console.error(\"Error improving text:\", error)\n    const errorMessage = error instanceof Error ? error.message : \"Unknown error\"\n    \n    return NextResponse.json(\n      {\n        error: \"Failed to generate alternatives\",\n        details: process.env.NODE_ENV === \"development\" ? errorMessage : undefined,\n      },\n      { status: 500 }\n    )\n  }\n}\n\n"],"names":[],"mappings":"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"}}]
}